<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PDF Generator Test</title>
  <style>
    body { font-family: sans-serif; max-width: 520px; margin: 60px auto; padding: 0 20px; }
    h2 { margin-bottom: 4px; }
    p.subtitle { color: #666; margin-top: 0; margin-bottom: 28px; font-size: 14px; }
    label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 4px; margin-top: 16px; }
    input { width: 100%; box-sizing: border-box; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
    button { margin-top: 24px; width: 100%; padding: 10px; background: #4f46e5; color: white; border: none; border-radius: 6px; font-size: 15px; cursor: pointer; }
    button:hover { background: #4338ca; }
    button:disabled { background: #a5b4fc; cursor: not-allowed; }
    .status { margin-top: 14px; font-size: 13px; padding: 10px 12px; border-radius: 6px; display: none; }
    .status.error { background: #fee2e2; color: #991b1b; display: block; }
    .status.success { background: #dcfce7; color: #166534; display: block; }
    .tabs { display: flex; gap: 8px; margin-bottom: 24px; }
    .tab { flex: 1; padding: 8px; text-align: center; border: 1px solid #ccc; border-radius: 6px; cursor: pointer; font-size: 14px; }
    .tab.active { background: #4f46e5; color: white; border-color: #4f46e5; }
    .section { display: none; }
    .section.active { display: block; }
    hr { border: none; border-top: 1px solid #e5e7eb; margin: 20px 0; }
  </style>
</head>
<body>
  <h2>PDF Generator</h2>
  <p class="subtitle">Calls your local backend at <code>http://localhost:3001</code></p>

  <div class="tabs">
    <div class="tab active" onclick="switchTab('user')">User PDF</div>
    <div class="tab" onclick="switchTab('admin')">Admin PDF</div>
  </div>

  <!-- USER -->
  <div id="user-section" class="section active">
    <label>Motif ID *</label>
    <input id="u-motifId" placeholder="e.g. 123" />
    <label>User Name</label>
    <input id="u-userName" placeholder="e.g. Alice" value="Test User" />
    <label>Motif Name</label>
    <input id="u-motifName" placeholder="e.g. My Motif" value="Test Motif" />
    <button onclick="generateUser()">Download User PDF</button>
  </div>

  <!-- ADMIN -->
  <div id="admin-section" class="section">
    <label>Motif ID *</label>
    <input id="a-motifId" placeholder="e.g. 123" />
    <label>Motif Image Link *</label>
    <input id="a-motifImageLink" placeholder="https://assets.knittedforyou.com/motif/123.png" />
    <label>Motif Page Link *</label>
    <input id="a-motifLink" placeholder="https://motif.knittedforyou.com/motif/123" />
    <label>User Name *</label>
    <input id="a-userName" placeholder="e.g. Alice" value="Test User" />
    <label>Motif Name *</label>
    <input id="a-motifName" placeholder="e.g. My Motif" value="Test Motif" />
    <label>Colors (comma separated) *</label>
    <input id="a-colors" placeholder="e.g. Red, Blue, White" />
    <button onclick="generateAdmin()">Download Admin PDF</button>
  </div>

  <div id="status" class="status"></div>

  <script>
    const BASE = 'http://localhost:3001';

    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', (i === 0) === (tab === 'user')));
      document.getElementById('user-section').classList.toggle('active', tab === 'user');
      document.getElementById('admin-section').classList.toggle('active', tab === 'admin');
      clearStatus();
    }

    function setStatus(msg, type) {
      const el = document.getElementById('status');
      el.textContent = msg;
      el.className = 'status ' + type;
    }

    function clearStatus() {
      const el = document.getElementById('status');
      el.className = 'status';
    }

    function downloadBlob(blob, filename) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    async function callPDF(url, body, filename, btn) {
      btn.disabled = true;
      clearStatus();
      try {
        const res = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });

        if (!res.ok) {
          const err = await res.json().catch(() => ({ message: res.statusText }));
          setStatus('Error ' + res.status + ': ' + (err.message || err.error || JSON.stringify(err)), 'error');
          return;
        }

        const blob = await res.blob();
        downloadBlob(blob, filename);
        setStatus('PDF downloaded successfully!', 'success');
      } catch (e) {
        setStatus('Could not reach backend. Is it running on port 3001? (' + e.message + ')', 'error');
      } finally {
        btn.disabled = false;
      }
    }

    function generateUser() {
      const motifId = document.getElementById('u-motifId').value.trim();
      if (!motifId) { setStatus('Motif ID is required.', 'error'); return; }
      const btn = event.target;
      callPDF(`${BASE}/pdf`, {
        motifId,
        userName: document.getElementById('u-userName').value.trim(),
        motifName: document.getElementById('u-motifName').value.trim()
      }, `motif-${motifId}-user.pdf`, btn);
    }

    function generateAdmin() {
      const motifId = document.getElementById('a-motifId').value.trim();
      if (!motifId) { setStatus('Motif ID is required.', 'error'); return; }
      const btn = event.target;
      callPDF(`${BASE}/pdf/admin`, {
        motifId,
        motifImageLink: document.getElementById('a-motifImageLink').value.trim(),
        motifLink:      document.getElementById('a-motifLink').value.trim(),
        userName:       document.getElementById('a-userName').value.trim(),
        motifName:      document.getElementById('a-motifName').value.trim(),
        colors:         document.getElementById('a-colors').value.trim()
      }, `motif-${motifId}-admin.pdf`, btn);
    }
  </script>
</body>
</html>
